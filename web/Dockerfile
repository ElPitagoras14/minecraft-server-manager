FROM node:20-alpine

WORKDIR /app

COPY package*.json ./

RUN npm install

ARG AUTH_SECRET
ENV AUTH_SECRET=${AUTH_SECRET}
ARG SERVER_API_URL
ENV SERVER_API_URL=${SERVER_API_URL}
ARG NEXT_PUBLIC_API_URL
ENV NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL}
ARG AUTH_EXPIRE_MINUTES
ENV AUTH_EXPIRE_MINUTES=${AUTH_EXPIRE_MINUTES}

COPY *.json ./
COPY *.ts ./
COPY *.m ./

RUN npm run build

CMD ["npm", "start"]